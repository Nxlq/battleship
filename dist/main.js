/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={d:(o,t)=>{for(var r in t)e.o(t,r)&&!e.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:t[r]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)};e.d({},{C:()=>A,o:()=>O});const o=e=>{let o=0;return{length:e,isSunk:!1,hit:function(){return o+=1,o},getHitCount:function(){return console.log(o),o},checkIfSunk:function(){return e-o<=0}}},t=()=>{let e=!1;const t=[],r=[];function n(){e=!0!==e}const s={carrier:o(5),battleship:o(4),cruiser:o(3),submarine:o(3),destroyer:o(2)};let i=0;function c(){return i}const l=new Map([]);for(let e=0;e<10;e+=1)for(let o=0;o<10;o+=1)l.set([e,o].toString(),"water");const d=()=>0!==Object.values(s).filter((e=>!e.checkIfSunk())).length;return{getBoard:()=>(console.log(l),l),setShip:(e,o,t="h")=>{if(console.log(e),console.log({coord:e,ship:o,direction:t}),!function(e,o,t){const r=s[o].length,n="h"===t?[e[0],e[1]+(r-1)]:[e[0]+(r-1),e[1]];return n[0]>=0&&n[0]<=9&&n[1]>=0&&n[1]<=9}(e,o,t))return console.error("invalid placement position");const r=s[o].length,n=[];for(let o=0;o<r;o+=1){const r="h"===t?[e[0],e[1]+o]:[e[0]+o,e[1]];if(console.log({coord:e,coordsToSet:r}),"water"!==l.get(r.toString()))return console.error("invalid coords: cannot place ships on top of each other");n.push(r)}return n.forEach((e=>l.set(e.toString(),o))),i+=1,console.log(c()),!0},logShips:()=>{console.log(s)},receiveAttack:o=>{if(!e)return console.log("board can not be currently attacked"),!1;const i=o.toString();return!t.includes(i)&&(!r.includes(i)&&("water"!==l.get(i)?(s[l.get(i)].hit(),t.push(i),d()?(n(),l.get(i)):"game over"):(r.push(o.toString()),n(),l.get(i))))},getShipHitcount:function(e){return s[e].getHitCount()},missedAttacks:r,hitAttacks:t,hasShipsAlive:d,toggleBoardState:n,isBoardActive:()=>(console.log(e),e),getShipsPlacedCount:c}},r=document.getElementById("btn-start-game"),n=document.querySelectorAll(".game-board"),s=document.querySelectorAll('[draggable="true"]'),i=document.querySelector(".game-board.one"),c=document.querySelector(".game-board.two"),l=document.querySelector(".game-container.one"),d=document.querySelector(".game-container.two"),a=document.getElementById("piece-selection"),u=document.querySelector("body"),g={piecesToTheRight:null,shipLength:null,piecesToTheLeft:null,shipDirection:"h",shipType:null,curCoord:null,shipHeadCoord:null,isDragging:!1,verticalHoverElArr:null,horizontalHoverElArr:null,targettedShip:null};function h(e){e.classList.add("water")}function E(e){e.classList.add("ship")}function p(){u.style.backgroundColor="red"}function S(e){[...i.children].forEach((o=>{const t=e.get(o.attributes.coords.value);"water"===t&&(o.classList.remove("hovered"),h(o)),"water"!==t&&(o.classList.remove("hovered"),E(o))}))}function m(e){e.target.classList.contains("invisible")||(console.log("start",e),[g.shipType]=e.target.classList,g.shipDirection="h",g.verticalHoverElArr=null,g.horizontalHoverElArr=null,g.targettedShip=document.querySelector(`.${g.shipType}`))}function v(e){}function T(e){if(e.preventDefault(),console.log("over"),!g.targettedShip.classList.contains("invisible")){if(!0===e.ctrlKey?g.shipDirection="v":g.shipDirection="h","h"===g.shipDirection){g.verticalHoverElArr?.forEach((e=>e.classList.remove("hovered"))),e.target.classList.add("hovered");const o=[];o.push(e.target);let t=e.target.nextElementSibling;for(let e=0;e<g.piecesToTheRight;e+=1)t.classList.add("hovered"),o.push(t),console.log(o),t=t.nextElementSibling;const r=g.shipLength-(g.piecesToTheRight+1);let n=e.target.previousElementSibling;for(let e=0;e<r;e+=1)n.classList.add("hovered"),o.push(n),n=n.previousElementSibling;g.horizontalHoverElArr=o}if("v"===g.shipDirection){g.horizontalHoverElArr.forEach((e=>e.classList.remove("hovered")));const o=[];o.push(e.target),e.target.classList.add("hovered");for(let e=0;e<g.piecesToTheLeft;e+=1){const t=document.querySelector(`[coords="${g.curCoord[0]-(e+1)},${g.curCoord[1]}"]`);t.classList.add("hovered"),o.push(t)}for(let e=0;e<g.piecesToTheRight;e+=1){const t=document.querySelector(`[coords="${g.curCoord[0]+(e+1)},${g.curCoord[1]}"]`);t.classList.add("hovered"),o.push(t)}g.verticalHoverElArr=o,console.log(g.verticalHoverElArr)}}}function f(e){e.preventDefault(),console.log("enter"),console.log("TARGET",e.target),console.log(e.target.nextElementSibling),g.curCoord=this.getAttribute("coords").split(",").map((e=>+e))}function L(e){console.log("leave"),console.log("TARGET",e.target),console.log(g.curCoord);const o=e.target.getAttribute("coords").split(",").map((e=>+e));if(e.target.classList.remove("hovered"),"h"===g.shipDirection){let o=e.target.nextElementSibling;for(let e=0;e<g.piecesToTheRight;e+=1)o.classList.remove("hovered"),o=o.nextElementSibling;const t=g.shipLength-(g.piecesToTheRight+1);let r=e.target.previousElementSibling;for(let e=0;e<t;e+=1)r.classList.remove("hovered"),r=r.previousElementSibling}if("v"===g.shipDirection){for(let e=0;e<g.piecesToTheLeft;e+=1)document.querySelector(`[coords="${o[0]-(e+1)},${o[1]}"]`).classList.remove("hovered");for(let e=0;e<g.piecesToTheRight;e+=1)document.querySelector(`[coords="${o[0]+(e+1)},${o[1]}"]`).classList.remove("hovered")}}function b(e){if(console.log(e.target,"!!!!!!!"),!g.targettedShip.classList.contains("invisible")){if(g.shipHeadCoord="h"===g.shipDirection?[g.curCoord[0],g.curCoord[1]-g.piecesToTheLeft]:[g.curCoord[0]-g.piecesToTheLeft,g.curCoord[1]],console.log(g.shipHeadCoord),console.log(e.target),console.log(g),!A.gameboard.setShip(g.shipHeadCoord,g.shipType,g.shipDirection))return console.log("UNSUCCESSFUL"),S(A.gameboard.getBoard()),void g.targettedShip.classList.remove("invisible");console.log("drop"),this.classList.remove("hovered"),this.classList.add("ship"),g.targettedShip.classList.add("invisible"),S(A.gameboard.getBoard()),5===A.gameboard.getShipsPlacedCount()&&(5===A.gameboard.getShipsPlacedCount()&&[...c.children].forEach((e=>e.addEventListener("click",(e=>{if(!e.target.classList.contains("coord-square"))return;const o=e.target.attributes.coords.value;console.log(o);const t=O.gameboard.receiveAttack(o);if(!t)return;"water"===t&&h(e.target),"water"!==t&&E(e.target),"game over"===t&&p(),A.gameboard.toggleBoardState();const r=O.playComputerTurn(A.gameboard.receiveAttack,A.gameboard.missedAttacks,A.gameboard.hitAttacks);r.atkResult&&("game over"===r&&p(),function(e){const o=document.createElement("div");o.classList.add("marked"),e.appendChild(o)}(document.querySelector(`[coords="${r.coords}"]`)),O.gameboard.toggleBoardState())})))),O.gameboard.toggleBoardState(),A.gameboard.isBoardActive()?(l.style.backgroundColor="#9c0000",d.style.backgroundColor="black"):O.gameboard.isBoardActive()&&(d.style.backgroundColor="#9c0000",l.style.backgroundColor="black"),i.childNodes.forEach((e=>{e.removeEventListener("dragover",T),e.removeEventListener("dragenter",f),e.removeEventListener("dragleave",L),e.removeEventListener("drop",b)})),u.removeChild(a),function(){const e=document.createElement("div");e.classList.add("header");const o=document.createElement("h2");o.textContent="Begin!",e.appendChild(o),u.insertAdjacentElement("afterbegin",e)}())}}s.forEach((e=>{console.log(e),e.addEventListener("dragstart",m),e.addEventListener("dragend",v),e.addEventListener("mousedown",(e=>{console.log(e),function(e){const o=e.parentElement.getAttribute("data-length");let t=0,r=e;for(;r.nextElementSibling;)console.log(r.nextElementSibling),r=r.nextElementSibling,t+=1;g.piecesToTheRight=t,g.shipLength=o,g.piecesToTheLeft=g.shipLength-(g.piecesToTheRight+1)}(e.target)}))}));const A={gameboard:t()},O=(()=>{const e=t(),o=function(){let e,o,t=[],r=!1,n=0;const s=e=>{t.push(e)},i=()=>{t=[]},c=()=>{n+=1};return{populateQueue:(o,l,d,a=null)=>{a||(((e,o,r)=>{Object.entries({left:[0,-1],up:[-1,0],right:[0,1],down:[1,0]}).forEach((t=>{const[n,i]=t,c=e.split(",").map((e=>+e)),l={direction:n,coords:[c[0]+i[0],c[1]+i[1]]};o.includes(l.coords.toString())||r.includes(l.coords.toString())||l.coords[0]<0||l.coords[0]>9||l.coords[1]<0||l.coords[1]>9||s(l)}));const i=[];t.forEach((e=>i.push(e.direction))),i.includes("left")||i.includes("up")||0!==n||c(),i.includes("right")||i.includes("down")||0!==n||c()})(o,l,d),r=!1),"left"!==a&&"right"!==a||(((o,t,r)=>{i();const l=[o[0],o[1]-1],d=[o[0],o[1]+1],a={};if(!(l[1]<0||d[1]>9||t.includes(l.toString())||r.includes(l.toString()))||(console.log("HERERERERERER"),0===n&&c(),2!==n)){if(!t.includes(l.toString())&&!r.includes(l.toString())&&l[1]>=0&&0===n)console.log("LEFT SQUARE IS OPEN SO LETS ATTACK IT"),a.direction="left",a.coords=l;else if(!t.includes(d.toString())&&!r.includes(d.toString())&&d[1]<=9)console.log("LEFT IS NOT OPEN BUT RIGHT SQUARE IS, SO LETS ATTACK IT"),a.direction="right",a.coords=d;else if(1===n&&(console.log("APPARENTLY ONE END WAS FOUND ?"),console.log("NEITHER LEFT OR RIGHT WAS OPEN SO LETS SEARCH TO THE RIGHT OF THE FIRST SHIP SQUARE HIT (IF VALID)"),a.direction="right",a.coords=[e[0],e[1]+1],a.coords[1]>9||t.includes(a.coords)||r.includes(a.coords)))return void console.log("COORDS RIGHT FROM THE ORIGINAL WERE INVALID SO JUST RETURN AND DONT ADD TO THE QUEUE SO THE NEXT ATTACK CAN BE RANDOM AGAIN");console.log({shipEndsFound:n}),s(a)}})(o,l,d),r=!0),"up"!==a&&"down"!==a||(((o,t,r)=>{if(i(),1!==n)Object.entries({up:[-1,0],down:[1,0]}).forEach((e=>{const[n,i]=e,c={direction:n,coords:[o[0]+i[0],o[1]+i[1]]};t.includes(c.coords.toString())||r.includes(c.coords.toString())||c.coords[0]<0||c.coords[0]>9||c.coords[1]<0||c.coords[1]>9||s(c)}));else{const o={direction:"down",coords:[e[0]+1,e[1]]};s(o)}})(o,l,d),r=!0)},dequeue:()=>{const e=t.shift();return o=e.direction,console.log(e.coords),console.log(o),e.coords},logQueue:()=>{console.log({queue:t})},emptyQueue:i,getLastDirectionChecked:()=>o,getQueueLength:()=>t.length,sethasFoundDirectionToTrue:()=>{r=!0},sethasFoundDirectionToFalse:()=>{r=!1},gethasFoundDirection:()=>r,log:()=>{console.log(r)},logEnds:()=>{console.log(n)},setFoundShipCoords:o=>{e="string"!=typeof o?o:o.split(",").map((e=>+e))},incrementEndsFound:c,resetEndsFound:()=>{n=0},getEndsFound:()=>n}}();function r(e,o){return Math.floor(Math.random()*(o-e+1)+e)}function n(){return 0===r(0,1)?"h":"v"}function s(){return[r(0,9),r(0,9)]}return{gameboard:e,placeShipsRandomly:function(){const o={carrier:n(),battleship:n(),cruiser:n(),submarine:n(),destroyer:n()};Object.entries(o).forEach((o=>{const[t,r]=o;let n=e.setShip(s(),t,r);for(;!n;)n=e.setShip(s(),t,r)}))},playComputerTurn:function(e,t,r){let n,i=!1;0!==o.getQueueLength()?(n=o.dequeue(),i=!0):(n=function(e,o){let t=s().toString();for(;e.includes(t)||o.includes(t);)t=s().toString();return t}(t,r),o.resetEndsFound());const c=e(n);return console.log({atkResult:c}),"water"===c||i?"water"!==c&&i?(console.log(n,"FOUND SEARCH DIRECTION SHOULD QUEUE COORDS TO PURSUE HORIZONTAL OR VERTICAL "),o.populateQueue(n,t,r,o.getLastDirectionChecked())):"water"===c&&i&&!0===o.gethasFoundDirection()&&(console.log("WHILE USING THE PERCIEVED DIRECTIONAL COORDS WE FOUND ONE END OF THE SHIP SO LETS QUEUE COORDS TO HUNT THE RIGHT SIDE IF NEEDED, AND IF NOT THEN SHIP ENDS FOUND SHOULD BE 2 AND GO BACK TO RANDOm MODE"),o.incrementEndsFound(),o.populateQueue(n,t,r,o.getLastDirectionChecked())):(console.log(n,"TURN PLAYED FROM RANDOMLY GENERATED COORDS SHOULD POPULATE SEARCH COORDS"),o.populateQueue(n,t,r),o.setFoundShipCoords(n)),o.logQueue(),{atkResult:c,coords:n}},attackQueue:o}})();O.placeShipsRandomly(),O.gameboard.getBoard(),window.addEventListener("DOMContentLoaded",(()=>{n.forEach((e=>{const o=[...e.children];let t=0,r=0;o.forEach((e=>{r>9&&(r=0,t+=1),e.setAttribute("coords",`${t},${r}`),r+=1}))})),console.log(i.childNodes),i.childNodes.forEach((e=>{e.addEventListener("dragover",T),e.addEventListener("dragenter",f),e.addEventListener("dragleave",L),e.addEventListener("drop",b)}))})),r.addEventListener("click",(()=>{A.gameboard.getBoard(),O.gameboard.getBoard()}))})();
//# sourceMappingURL=main.js.map