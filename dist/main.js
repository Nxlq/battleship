/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{C:()=>y,o:()=>C});const t=e=>{let t=0;return{length:e,isSunk:!1,hit:function(){return t+=1,t},getHitCount:function(){return console.log(t),t},checkIfSunk:function(){return e-t<=0}}},o=()=>{let e=!1;const o=[],r=[];function n(){e=!0!==e}const i={carrier:t(5),battleship:t(4),cruiser:t(3),submarine:t(3),destroyer:t(2)};let s=0;function c(){return s}const l=new Map([]);for(let e=0;e<10;e+=1)for(let t=0;t<10;t+=1)l.set([e,t].toString(),"water");const a=()=>0!==Object.values(i).filter((e=>!e.checkIfSunk())).length;return{getBoard:()=>(console.log(l),l),setShip:(e,t,o="h")=>{if(console.log({coord:e,ship:t,direction:o}),!function(e,t,o){const r=i[t].length,n="h"===o?[e[0],e[1]+(r-1)]:[e[0]+(r-1),e[1]];return n[0]>=0&&n[0]<=9&&n[1]>=0&&n[1]<=9}(e,t,o))return console.error("invalid placement position");const r=i[t].length,n=[];for(let t=0;t<r;t+=1){const r="h"===o?[e[0],e[1]+t]:[e[0]+t,e[1]];if(console.log({coord:e,coordsToSet:r}),"water"!==l.get(r.toString()))return console.error("invalid coords: cannot place ships on top of each other");n.push(r)}return n.forEach((e=>l.set(e.toString(),t))),s+=1,console.log(c()),!0},logShips:()=>{console.log(i)},receiveAttack:t=>{if(!e)return console.log("board can not be currently attacked"),!1;const s=t.toString();return!o.includes(s)&&(!r.includes(s)&&("water"!==l.get(s)?(i[l.get(s)].hit(),o.push(s),a()?(n(),l.get(s)):"game over"):(r.push(t.toString()),n(),l.get(s))))},getShipHitcount:function(e){return i[e].getHitCount()},missedAttacks:r,hitAttacks:o,hasShipsAlive:a,toggleBoardState:n,isBoardActive:()=>(console.log(e),e),getShipsPlacedCount:c}},r=document.getElementById("btn-start-game"),n=document.querySelectorAll(".game-board"),i=document.querySelectorAll('[draggable="true"]'),s=document.querySelector(".game-board.one"),c=document.querySelector(".game-board.two"),l=document.querySelector(".game-container.one"),a=document.querySelector(".game-container.two"),d=document.getElementById("piece-selection"),g=document.querySelector("body"),u={piecesToTheRight:null,shipLength:null,piecesToTheLeft:null,shipDirection:"h",shipType:null,curCoord:null,shipHeadCoord:null,isDragging:!1,verticalHoverElArr:null,horizontalHoverElArr:null,targettedShip:null};function h(e){e.classList.add("water")}function p(e){e.classList.add("ship")}function v(){g.style.backgroundColor="red"}function m(e){[...s.children].forEach((t=>{const o=e.get(t.attributes.coords.value);"water"===o&&(t.classList.remove("hovered"),h(t)),"water"!==o&&(t.classList.remove("hovered"),p(t))}))}function f(e){e.target.classList.contains("invisible")||(console.log("start",e),[u.shipType]=e.target.classList,u.shipDirection="h",u.verticalHoverElArr=null,u.horizontalHoverElArr=null,u.targettedShip=document.querySelector(`.${u.shipType}`))}function b(e){}function S(e){if(e.preventDefault(),console.log("over"),!u.targettedShip.classList.contains("invisible")){if(!0===e.ctrlKey?u.shipDirection="v":u.shipDirection="h","h"===u.shipDirection){u.verticalHoverElArr?.forEach((e=>e.classList.remove("hovered"))),e.target.classList.add("hovered");const t=[];t.push(e.target);let o=e.target.nextElementSibling;for(let e=0;e<u.piecesToTheRight;e+=1)o.classList.add("hovered"),t.push(o),console.log(t),o=o.nextElementSibling;const r=u.shipLength-(u.piecesToTheRight+1);let n=e.target.previousElementSibling;for(let e=0;e<r;e+=1)n.classList.add("hovered"),t.push(n),n=n.previousElementSibling;u.horizontalHoverElArr=t}if("v"===u.shipDirection){u.horizontalHoverElArr.forEach((e=>e.classList.remove("hovered")));const t=[];t.push(e.target),e.target.classList.add("hovered");for(let e=0;e<u.piecesToTheLeft;e+=1){const o=document.querySelector(`[coords="${u.curCoord[0]-(e+1)},${u.curCoord[1]}"]`);o.classList.add("hovered"),t.push(o)}for(let e=0;e<u.piecesToTheRight;e+=1){const o=document.querySelector(`[coords="${u.curCoord[0]+(e+1)},${u.curCoord[1]}"]`);o.classList.add("hovered"),t.push(o)}u.verticalHoverElArr=t,console.log(u.verticalHoverElArr)}}}function E(e){e.preventDefault(),console.log("enter"),console.log("TARGET",e.target),console.log(e.target.nextElementSibling),u.curCoord=this.getAttribute("coords").split(",").map((e=>+e))}function L(e){console.log("leave"),console.log("TARGET",e.target),console.log(u.curCoord);const t=e.target.getAttribute("coords").split(",").map((e=>+e));if(e.target.classList.remove("hovered"),"h"===u.shipDirection){let t=e.target.nextElementSibling;for(let e=0;e<u.piecesToTheRight;e+=1)t.classList.remove("hovered"),t=t.nextElementSibling;const o=u.shipLength-(u.piecesToTheRight+1);let r=e.target.previousElementSibling;for(let e=0;e<o;e+=1)r.classList.remove("hovered"),r=r.previousElementSibling}if("v"===u.shipDirection){for(let e=0;e<u.piecesToTheLeft;e+=1)document.querySelector(`[coords="${t[0]-(e+1)},${t[1]}"]`).classList.remove("hovered");for(let e=0;e<u.piecesToTheRight;e+=1)document.querySelector(`[coords="${t[0]+(e+1)},${t[1]}"]`).classList.remove("hovered")}}function T(e){if(console.log(e.target,"!!!!!!!"),!u.targettedShip.classList.contains("invisible")){if(u.shipHeadCoord="h"===u.shipDirection?[u.curCoord[0],u.curCoord[1]-u.piecesToTheLeft]:[u.curCoord[0]-u.piecesToTheLeft,u.curCoord[1]],console.log(u.shipHeadCoord),console.log(e.target),console.log(u),!y.gameboard.setShip(u.shipHeadCoord,u.shipType,u.shipDirection))return console.log("UNSUCCESSFUL"),m(y.gameboard.getBoard()),void u.targettedShip.classList.remove("invisible");console.log("drop"),this.classList.remove("hovered"),this.classList.add("ship"),u.targettedShip.classList.add("invisible"),m(y.gameboard.getBoard()),5===y.gameboard.getShipsPlacedCount()&&(5===y.gameboard.getShipsPlacedCount()&&[...c.children].forEach((e=>e.addEventListener("click",(e=>{if(!e.target.classList.contains("coord-square"))return;const t=e.target.attributes.coords.value;console.log(t);const o=C.gameboard.receiveAttack(t);if(!o)return;"water"===o&&h(e.target),"water"!==o&&p(e.target),"game over"===o&&v(),y.gameboard.toggleBoardState();const r=C.playComputerTurn(y.gameboard.receiveAttack,y.gameboard.missedAttacks,y.gameboard.hitAttacks);r.atkResult&&("game over"===r&&v(),function(e){const t=document.createElement("div");t.classList.add("marked"),e.appendChild(t)}(document.querySelector(`[coords="${r.coords}"]`)),C.gameboard.toggleBoardState())})))),C.gameboard.toggleBoardState(),y.gameboard.isBoardActive()?(l.style.backgroundColor="#9c0000",a.style.backgroundColor="black"):C.gameboard.isBoardActive()&&(a.style.backgroundColor="#9c0000",l.style.backgroundColor="black"),s.childNodes.forEach((e=>{e.removeEventListener("dragover",S),e.removeEventListener("dragenter",E),e.removeEventListener("dragleave",L),e.removeEventListener("drop",T)})),g.removeChild(d),function(){const e=document.createElement("div");e.classList.add("header");const t=document.createElement("h2");t.textContent="Begin!",e.appendChild(t),g.insertAdjacentElement("afterbegin",e)}())}}i.forEach((e=>{console.log(e),e.addEventListener("dragstart",f),e.addEventListener("dragend",b),e.addEventListener("mousedown",(e=>{console.log(e),function(e){const t=e.parentElement.getAttribute("data-length");let o=0,r=e;for(;r.nextElementSibling;)console.log(r.nextElementSibling),r=r.nextElementSibling,o+=1;u.piecesToTheRight=o,u.shipLength=t,u.piecesToTheLeft=u.shipLength-(u.piecesToTheRight+1)}(e.target)}))}));const y={gameboard:o()},C=(()=>{const e=o();function t(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function r(){return 0===t(0,1)?"h":"v"}function n(){return[t(0,9),t(0,9)]}return{gameboard:e,placeShipsRandomly:function(){const t={carrier:r(),battleship:r(),cruiser:r(),submarine:r(),destroyer:r()};Object.entries(t).forEach((t=>{const[o,r]=t;let i=e.setShip(n(),o,r);for(;!i;)i=e.setShip(n(),o,r)}))},playComputerTurn:function(e,t,o){const r=function(e,t){let o=n().toString();for(;e.includes(o)||t.includes(o);)o=n().toString();return o}(t,o);return{atkResult:e(r),coords:r}}}})();C.placeShipsRandomly(),C.gameboard.getBoard(),window.addEventListener("DOMContentLoaded",(()=>{n.forEach((e=>{const t=[...e.children];let o=0,r=0;t.forEach((e=>{r>9&&(r=0,o+=1),e.setAttribute("coords",`${o},${r}`),r+=1}))})),console.log(s.childNodes),s.childNodes.forEach((e=>{e.addEventListener("dragover",S),e.addEventListener("dragenter",E),e.addEventListener("dragleave",L),e.addEventListener("drop",T)}))})),r.addEventListener("click",(()=>{y.gameboard.getBoard(),C.gameboard.getBoard()}))})();
//# sourceMappingURL=main.js.map